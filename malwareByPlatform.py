#!/usr/local/bin/python3

import argparse
import sys
import pyattck
import platformstats


def run(platform, verbose):
    platform = platform.lower()
    print('entered: ', platform)
    att = pyattck.Attck()

    for malware in att.malwares:
        if platform == 'all':
            printData(platform, malware, verbose)
        elif platform == 'none':
            if malware.platforms is None:
                printData(platform, malware, verbose)
        else:
            if malware.platforms is not None:
                arr_platforms = list(map(str.lower, malware.platforms))
                if arr_platforms.count(platform) > 0:
                    printData(platform, malware, verbose)


def printData(platform, malware, verbose):
    print('Malware Name: ', malware.name)
    if verbose:
        print('Platforms:', malware.platforms)
        print('Description: ', malware.description, '\n')


if __name__ == "__main__":
    # create parser
    parser = argparse.ArgumentParser(
        prog='malwareByPlatform',
        description="Lists the names of maleware that can potentially attack a given platform")
    arrPlatformChoices = ['all', 'windows',
                          'linux', 'macos', 'none', 'android']
    parser.add_argument('-p', '--platform',
                        default='all', const='all',
                        nargs='?', choices=arrPlatformChoices,
                        type=str.lower)

    # parser.add_argument("platform", help = "the platform that the malware attacks (case insensitive)")
    parser.add_argument(
        "-s", "--stats",
        action='store_true',
        help="Show the count of malware per platform")
    parser.add_argument(
        "-so", "--statsonly",
        action='store_true',
        help="Show the count of malware per platform. Nothing else.")
    parser.add_argument("-v", "--verbose",
                        action="store_true",
                        help="Show details (applicable platforms and descriptions)")
    args = parser.parse_args()
    verbose = args.verbose
    if verbose:
        print(f'Running: {sys.argv[0]}')
    if(not args.statsonly):
        run(args.platform, verbose)

    if args.stats or args.statsonly:
        platformstats.run()
